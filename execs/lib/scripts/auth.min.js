!function(){firebase.initializeApp({apiKey:"AIzaSyBQQPdSR_XQ8vW5ud0rKCkZqrNnrcC8jQs",authDomain:"bthsamongus.firebaseapp.com",databaseURL:"https://bthsamongus.firebaseio.com",projectId:"bthsamongus",storageBucket:"bthsamongus.appspot.com",messagingSenderId:"958186855973",appId:"1:958186855973:web:96ea662fa0b3464f0da9cc"});const t=firebase.auth(),e=firebase.database();!function(){document.querySelector("#auth div:last-of-type span").onclick=function(){t.signOut()};const a=document.getElementById("auth");a.remove(),t.onAuthStateChanged((t=>{t?(document.querySelector(".header").prepend(a),document.querySelector(".main .login").style.display="none",document.querySelector(".main .info").style.display="block",function(){function t(t){const e=document.createElement("section");for(const s in t)e.setAttribute(s,t[s]);return e}const a=document.getElementById("infoContent");a.innerHTML="";const c=t({class:"functions"}),r=t({id:"entries"}),l=t({id:"members"});!async function(){await e.ref("members").once("value").then((t=>{const e=t.val();for(const t in e){const s=e[t];n[t]=new o({first:s.first||"Blank",last:s.last||"Blank",osis:s.osis||"123456789",email:s.email||"blankb@nycstudents.net",year:s.year||""+(new Date).getFullYear(),score:s.score||0,sgo:s.sgo||"no",entries:Object.values(s.entries||{})})}})),await e.ref("entries").once("value").then((t=>{const e=t.val();for(const t in e){const n=e[t];s.push(new i({id:t,first:n.first||"Blank",last:n.last||"Blank",sgo:n.sgo||"No",email:n.email||"blankb@nycstudents.net",osis:n.osis||"123456789",year:n.year||""+(new Date).getFullYear(),date:n.date||""+(new Date).get12AMTime(),timestamp:n.timestamp||""+(new Date).getTime()}))}})),function(t,s,n){function i(t,e){const s=document.createElement("span");return s.innerHTML=t,s.setAttribute("data-active","no"),s.onclick=e,s}const o=[];!async function(){const a=""+(new Date).get12AMTime();if(await e.ref("meta").once("value").then((t=>(""+t.val().date).trim()!=a))){const t=i("open forms",(s=>{e.ref("meta").update({date:a}).then((()=>{t.remove()}))}));o.push(t)}const c=i("entries",(t=>{})),r=i("members",(t=>{}));c.onclick=t=>{s.style.display="flex",n.style.display="none",c.setAttribute("data-active","yes"),r.setAttribute("data-active","no")},r.onclick=t=>{s.style.display="none",n.style.display="flex",c.setAttribute("data-active","no"),r.setAttribute("data-active","yes")},c.onclick();for(const e of[...o,c,r])t.appendChild(e)}()}(c,r,l),function(t){for(const e of s)t.appendChild(e.node)}(r),function(t){for(const e in n)t.appendChild(n[e].node)}(l)}();for(const t of[c,r,l])a.appendChild(t)}()):(a.remove(),document.querySelector(".main .login").style.display="block",document.querySelector(".main .info").style.display="none")}))}(),Date.prototype.get12AMTime||(Date.prototype.get12AMTime=function(){let t=(this.toString()+"").split(" ");return t[4]="00:00:00",new Date(t.join(" ")).getTime()});const s=[],n={};class i{constructor(t){this.id,this.first,this.last,this.sgo,this.email,this.osis,this.year,this.date,this.timestamp,this.type="";for(const e in t)this[e]=t[e];n[this.osis]||(n[this.osis]=new o({first:this.first||"Blank",last:this.last||"Blank",osis:this.osis||"123456789",email:this.email||"blankb@nycstudents.net",year:this.year||""+(new Date).getFullYear(),sgo:this.sgo,score:this.score||0,entries:Object.values(t.entries||{})}),n[this.osis].sync()),this.node,this.compile()}compile(){const t=document.createElement("section");t.setAttribute("class","entry");const s=document.createElement("h2");s.innerHTML=`${this.first} ${this.last}`;const i=document.createElement("div");i.setAttribute("class","content");for(const t of"osis;email;date".split(";")){const e=document.createElement("p");e.innerHTML=""+this[t],"date"==t&&(e.innerHTML=""+new Date(parseInt(this[t])).toString().split(" ").slice(0,3).join(" ")),i.appendChild(e)}const o=document.createElement("div");o.setAttribute("class","choices");const a=document.createElement("span");a.innerHTML="reject",a.onclick=t=>{this.type="rejected",n[this.osis].addEntry(this),e.ref("entries").child(this.id).remove(),this.node.remove()};const c=document.createElement("span");c.innerHTML="accept",c.onclick=t=>{this.type="accepted",n[this.osis].addEntry(this),e.ref("entries").child(this.id).remove(),this.node.remove()};for(const t of[a,c])o.append(t);for(const e of[s,i,o])t.appendChild(e);this.node=t}}class o{constructor(t){this.first,this.last,this.osis,this.email,this.year,this.entries,this.score,this.sgo;for(const e in t)this[e]=t[e];this.node,this.calc(!0),this.compile()}addEntry(t){this.entries.push({timestamp:t.timestamp,date:t.date,decision:t.type}),this.first=t.first,this.last=t.last,this.email=t.email,this.sgo=t.sgo,this.year=t.year,this.calc(),this.compile(),this.sync()}compile(){if(!this.node){const t=document.createElement("section");t.setAttribute("class","member"),this.node=t}const t=document.createElement("h2");t.innerHTML=`${this.first} ${this.last}`;const e=document.createElement("div");e.setAttribute("class","content");for(const t of"osis;email;sgo;year;score".split(";")){const s=document.createElement("p");s.innerHTML=""+this[t],"sgo"==t&&(s.innerHTML="yes"==this[t]?"has sgo":"no sgo"),"year"==t&&(s.innerHTML="Grads. in "+this[t]),"score"==t&&(s.innerHTML=`${this[t]} point${1!=parseInt(this[t])?"s":""}`),e.appendChild(s)}const s=document.createElement("div");s.setAttribute("class","entries");const n=document.createElement("h3");n.innerHTML="Entries";const i=document.createElement("div");for(const t of this.entries.sort(((t,e)=>parseInt(e.timestamp)-parseInt(t.timestamp)))){const e=document.createElement("p");e.innerHTML=`${new Date(parseInt(t.date)).toString().split(" ").slice(0,3).join(" ")} [${t.decision}]`,i.appendChild(e)}for(const t of[n,i])s.appendChild(t);this.node.innerHTML="";for(const n of[t,e,s])this.node.appendChild(n)}calc(t){const s=[...this.entries],n=[];for(let t=0;t<s.length;t++){const e=s[t];let i=!1;for(const t of n)if(dateFns.isSameWeek(new Date(parseInt(e.date)),new Date(parseInt(t[0].date)))){t.push(e),i=!0;break}i||n.push([e])}let i=0;for(const t of n)t.map((t=>t.decision)).filter((t=>"accepted"==t)).length>0&&i++;if(this.score=i,t){const t={};t[this.osis+"/score"]=this.score,e.ref("members").update(t)}}sync(){const t={};t[this.osis]={first:this.first,last:this.last,osis:this.osis,email:this.email,sgo:this.sgo,year:this.year,score:this.score,entries:Object.assign({},this.entries)},e.ref("members").update(t)}}}();
