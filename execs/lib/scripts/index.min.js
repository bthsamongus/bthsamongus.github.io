!function(){class e{constructor(e,t,n){this.hasWarned=!0,this.validate=n.bind(this);const i=document.createElement("h2");i.innerHTML=(""+e).trim();const a=document.createElement("input");a.oninput=e=>{this.hasWarned&&this.unwarn()},s.setAttributes(a,t),this.input=a;const r=document.createElement("p");r.innerHTML="sample warning",this.warning=r;const o=document.createElement("section");s.setAttributes(o,{class:"field","data-field-incorrect":"false"}),s.addChildren(o,[i,a,r]),this.node=o,this.unwarn()}get untrimmedValue(){return""+this.input.value}get value(){return(""+this.input.value).trim()}unwarn(){this.hasWarned&&(this.hasWarned=!1,this.node.setAttribute("data-field-incorrect","false"),this.node.removeChild(this.warning))}warn(e){this.hasWarned||this.node.appendChild(this.warning),this.hasWarned=!0,this.node.setAttribute("data-field-incorrect","true"),this.warning.innerHTML=(""+e).trim()}check(){return[...this.validate(this)]}empty(){this.input.value=""}}class t{constructor(e,t){const s=document.createElement("section"),n=document.createElement("div"),i=document.createElement("span");n.appendChild(i),s.setAttribute("class","loader"),s.appendChild(n),this.node=s,this._text=null,this.parent=t||null,e&&this.parse(e).length>0&&(this.text=e,s.appendChild(this.text)),t&&this.add()}set text(e){null==this._text&&(this._text=document.createElement("p")),this._text.innerHTML=this.parse(e)}get text(){return this._text}set parent(e){if("string"==typeof e){const t=document.querySelector(this.parse(e));t&&(this._parent=t)}else this._parent=e}parse(e){return(""+e).trim()}add(e){null!=this._parent&&(this.node.remove(),e||this._parent.appendChild(this.node))}stop(){this.add(!0)}}class s{static setAttributes(e,t){for(const s in t)e.setAttribute((""+s).trim(),(""+t[s]).trim())}static addChildren(e,t){for(const s of t)e.appendChild(s)}static formatName(e){const t=[...e.matchAll(/[^\s]+/g)].map((e=>e[0].toLowerCase()));for(let e=0;e<t.length;e++){const s=t[e].split("");for(let e=0;e<s.length;e++)if(/[a-z]/.test(s[e])){s[e]=s[e].toUpperCase();break}t[e]=s.join("")}return t.join(" ")}static get12AMTime(e){let t=(""+(e||new Date).toString()).split(" ");return t[4]="00:00:00",new Date(t.join(" ")).getTime()}}firebase.initializeApp({apiKey:"AIzaSyBQQPdSR_XQ8vW5ud0rKCkZqrNnrcC8jQs",authDomain:"bthsamongus.firebaseapp.com",databaseURL:"https://bthsamongus.firebaseio.com",projectId:"bthsamongus",storageBucket:"bthsamongus.appspot.com",messagingSenderId:"958186855973",appId:"1:958186855973:web:96ea662fa0b3464f0da9cc"});const n=firebase.auth(),i=firebase.database(),a=(new class{constructor(){return this.container=document.querySelector(".header"),this.anchors=[],this.mobileOpened=!0,this.authOpened=!0,this}toggleMobile(){return this.mobileOpened=!this.mobileOpened,this.container.setAttribute("data-mobile-opened",this.mobileOpened),this}changeAuth(e){return this.authOpened=e,this.container.setAttribute("data-auth-opened",""+e),this}addAnchor(e,t){const s=document.createElement("a");s.innerHTML=(""+e).trim(),s.setAttribute("href",t||".");const n=document.createElement("div");return n.appendChild(s),this.anchors.push(n),this}compileAndRun(){function e(){const e=document.createElement("div"),t=document.createElement("span");return t.innerHTML="Sign Out",t.onclick=e=>{n.signOut()},e.appendChild(t),e}const t=document.createElement("div");t.setAttribute("class","important");const i=document.createElement("img");s.setAttributes(i,{alt:"hamburger icon",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png"}),i.onclick=e=>{this.toggleMobile()},t.appendChild(i);const a=document.createElement("section");a.setAttribute("class","nav"),s.addChildren(a,[...this.anchors,e(),t]);const r=document.createElement("section");return r.setAttribute("class","panel"),s.addChildren(r,[...this.anchors.slice(1).map((e=>e.cloneNode(!0))),e()]),this.container.innerHTML="",s.addChildren(this.container,[a,r]),this.toggleMobile(),this.changeAuth(!1),this}}).addAnchor("BTHS Among Us","..").addAnchor("Home","..").addAnchor("Attendance","../attendance").addAnchor("Executives").compileAndRun(),r=document.querySelector(".main .input");r.remove(),r.appendChild(new class{constructor(e,t){this.title=e,this.fields=[],this.submit=t.bind(this),this.statusShown=!0,this.overlayShown=!0,this.isSubmitting=!1;const s=document.createElement("section");return s.setAttribute("class","form"),this.node=s,this}get fieldResults(){const e=[];for(const t of this.fields)e.push([...t.check()]);return e}addField(e){return this.fields.push(e),this}compile(){const e=document.createElement("section");e.setAttribute("class","content"),this.content;const n=document.createElement("h1");n.innerHTML=(""+this.title).trim();const i=document.createElement("section");i.setAttribute("data-response-type","bad"),i.innerHTML="Sample status",this.status=i;const a=[];for(const e of this.fields)a.push(e.node);const r=document.createElement("section"),o=document.createElement("span");o.innerHTML="Submit";o.onclick=e=>{this.submit(this)},r.appendChild(o),s.addChildren(e,[n,i,...a,r]);const c=document.createElement("section");return c.setAttribute("class","overlay"),this.loader=new t("Loading",c),this.overlay=c,this.node.innerHTML="",s.addChildren(this.node,[e,c]),this.hideStatus(),this.hideOverlay(),this}hideStatus(){return this.statusShown&&(this.statusShown=!1,this.status.style.display="none"),this}updateStatus(e,t){return this.statusShown=!0,this.status.style.display="block",this.status.setAttribute("data-response-type",e?"bad":"good"),this.status.innerHTML=(""+t).trim(),this}hideOverlay(){return this.overlayShown&&(this.overlayShown=!1,this.overlay.style.display="none"),this}updateOverlay(e){return this.overlayShown=!0,this.overlay.style.display="block",this.loader.text=e,this}empty(){for(const e of this.fields)e.empty();return this}}("Login",(e=>{e.isSubmitting||(e.isSubmitting=!0,async function(){e.hideStatus();const t=e.fieldResults;let s=[!0,"Your form was filled out incorrectly. Fix it before resubmitting."];do{if(e.updateOverlay("Checking Inputs"),t.filter((e=>!e[0])).length>0)break;e.updateOverlay("Checking Credentials");const i=[...t.map((e=>e[1]))];await n.signInWithEmailAndPassword(...i).catch((e=>!e))?s=[!1,"Login Successful."]:s[1]="Invalid credentials. Check your inputs."}while(0);setTimeout((()=>{e.updateStatus(...s),s[0]||e.empty(),e.isSubmitting=!1,e.hideOverlay()}),500)}())})).addField(new e("Email",{required:"",type:"email"},(e=>{let t=e.value.toLowerCase(),s=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^[^@\s]+@([^@\s]+\.)+[^@\s\.]+/.test(t)){e.warn("Enter in a valid email");break}s=[!0,t]}while(0);return s}))).addField(new e("Password",{required:"",type:"password"},(e=>{let t=e.untrimmedValue,s=[!1,null];do{if(t.length<1){e.warn("Required");break}s=[!0,t]}while(0);return s}))).compile().node);const o=document.querySelector(".main .board");o.remove();const c=document.querySelector(".main");let l=!1;const d=new class{constructor(e){this.outNode=e,this.listening=!1,this._data={},this.focus={member:null,week:null}}listen(){return this.listening||(this.listening=!0,i.ref("/members").on("value",(e=>{this._data=e.val()||{},this.retarget()}))),this}update(){const e=this.data,t=$("<button>Back</button>"),s=[];for(let t=0;t<e.scope.length;t++){const n=e.scope[t],i=$(`<span class="link">${(""+n).replace(/-/,"&#8209;")}</span>`);2==t?i.click((()=>{})):1==t?i.click((()=>{"member"!=e.scope&&this.target(n)})):i.click((()=>{"root"!=e.scope&&this.target()})),s.push($("<span>/</span>"),i)}const n=$('<section id="exec-nav"></section>').append(t,$("<p>").append(...s)),a=$(`<section id="exec-window" data-type="${e.type}"></section>`);switch(e.type){case"member":{t.click((()=>{this.target()})),a.prop("data-type","member");const s=e.value,n=$('<div class="box">');for(const e of Object.keys(s.forms).sort(((e,t)=>{const s=e.split("-").map((e=>parseInt(e))),n=t.split("-").map((e=>parseInt(e)));return s[0]<n[0]?-1:s[0]>n[0]?1:s[1]<n[1]?-1:s[1]>n[1]?1:0})).reverse())n.append($('<div class="week">').append($(`<h2>Week ${e}</h2>`),$(`<p>${s.forms[e].length} form${1==s.forms[e].length?"":"s"}</p>`),$("<button>See More</button>").click((()=>{this.target(s.osis,e)}))).css("background-color",this.hasMissingGrades(s.osis,e)?"#b1d8ff":"#ebffeb"));const i=(e,t)=>$(`<h1><span>${e}</span><span>${t}</span></h1>`);a.append(i("Last",s.last),i("First",s.first),i("OSIS",s.osis),i("Email",s.email),i("Year",s.year),i("SGO",s.sgo?"YES":"NO"),i("Points",`${s.score.value} (last updated on ${new Date(s.score.updated).toLocaleString()})`),i("Forms",""),n);break}case"week":{t.click((()=>{this.target(this.focus.member)})),a.prop("data-type","week");const s=e.value;for(let t=0;t<s.length;t++){const n=t,r=s[n],o=r.decision,c=$(`<div class="decision" data-type="${"WAITING"==o?"waiting":"reviewed"}">`);if("WAITING"==o){const t=(t,s)=>$("<button>").text(t).click((()=>{i.ref(`/members/${e.scope[1]}/forms/${e.scope[2]}/${n}/decision`).set(s?"ACCEPTED":"DENIED",(e=>{e&&console.err(e)}))}));c.append(t("PASS",!0),t("FAIL",!1))}else c.text(o);a.append($('<div class="form">').append($(`<h1>Form ${new Date(r.date).toDateString().replace(/\s/g,"-")}</h1>`),$(`<p>${new Date(r.timestamp).toLocaleString()}</p>`),c).css("background-color","WAITING"==o?"#b1d8ff":"#ebffeb"))}break}case"root":{t.prop("disabled",!0),a.prop("data-type","root");const s=(e,t)=>$(`<span class="${t}">${e||"N/A"}</span>`),n=e=>s(e,"row");let i=!1;const r=Object.values(e.value),o=this,c=(e,t=null)=>{const c=s(e,"head");if(null!=t){c.addClass("sortable");const e=[...r];e.sort(((e,s)=>{const n=""+("score"==t?e.score.value:e[t]),i=""+("score"==t?s.score.value:s[t]);return n<i?-1:n>i?1:0})),e.reverse(),c.click((async()=>{i||(i=!0,e.reverse(),$("span.row").remove(),$("body").css("cursor","progress"),await new Promise(((t,s)=>{const r=[];for(const t of Object.values(e)){const e=[n(t.last),n(t.first),n(t.osis),n(t.email),n(t.year),n(t.sgo?"YES":"NO"),n(t.score.value),n("more").click((()=>{o.target(""+t.osis)}))],s=o.hasMissingGrades(t.osis);s&&e.map((e=>e.css("background-color","#b1d8ff"))),e.map((t=>t.hover((()=>{e.map((e=>e.css("background-color","rgb(220, 220, 220)")))}),(()=>{e.map((e=>e.css("background-color",s?"#b1d8ff":"initial")))})))),r.push(...e)}a.append(...r),setTimeout((()=>{i=!1,t(!0)}),1e3)})),$("body").css("cursor","auto"))}))}return c},l=c("Last","last");a.append(l,c("First","first"),c("OSIS","osis"),c("Email","email"),c("Class","year"),c("SGO","sgo"),c("Points","score"),c("Nav")),l.click();break}default:console.error("Invalid data-type detected.")}const r=$(this.outNode);r.empty(),r.append(n,a)}retarget(){this.target(...Object.values(this.focus))}target(e=null,t=null){this.focus={member:e,week:t};const s=this._data[""+e];if(s){s.forms[""+t]||(this.focus.week=null)}else this.focus={member:null,week:null};this.update()}get data(){const e={type:"root",scope:["members"],value:this._data},t=this.focus.member,s=this.focus.week;return t&&(e.type="member",e.scope.push(t),e.value=e.value[""+t],s&&(e.type="week",e.scope.push(s),e.value=e.value.forms[""+s])),e}hasMissingGrades(e,t=null){const s=this._data[""+e];if(s){const e=e=>e.findIndex((e=>"WAITING"==e.decision))>-1;if(t){const n=s.forms[""+t];if(n&&e(n))return!0}else for(const t of Object.values(s.forms))if(e(t))return!0}return!1}}(o);n.onAuthStateChanged((e=>{e?(l=!0,a.changeAuth(!0),r.remove(),c.appendChild(o),d.listen()):(a.changeAuth(!1),c.appendChild(r),o.remove(),l&&window.location.reload())}))}();
