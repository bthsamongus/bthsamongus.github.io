!function(){Date.prototype.get12AMTime||(Date.prototype.get12AMTime=function(){let e=(this.toString()+"").split(" ");return e[4]="00:00:00",new Date(e.join(" ")).getTime()});const e=document.getElementById("form");function t(e,t,n){const r=document.createElement("div");for(const t in e)r.setAttribute(t,e[t]);";;;;"!=t&&(r.innerHTML=t);for(const e of n)r.appendChild(e);return r}class n{constructor(e,t,n,r){this.title=document.createElement("h2"),this.title.innerHTML=e,this.input=document.createElement("input");for(const e in n)this.input.setAttribute(e,n[e]);this.input.oninput=e=>{this.hasWarned&&(this.hasWarned=!1,this.warning.style.display="none")},this.warning=document.createElement("h3"),this.warning.innerHTML="Error",this.hasWarned=!1,this.validate=r.bind(this),this.key=t,this.node,this.compile()}compile(){this.node=t({class:"field"},"",[this.title,this.input,this.warning])}get value(){return this.input.value.trim()}check(){return this.validate(this)}warn(e){this.warning.innerHTML=e,this.warning.style.display="block",this.hasWarned=!0}empty(){this.input.value=""}}function r(e){const t=(""+e).toLowerCase().split("");for(let e=0,n=!1;e<t.length;e++){const r=t[e];r.toUpperCase()!=r.toLowerCase()?n||(t[e]=r.toUpperCase(),n=!0):n=!1}return t.join("")}const a=[new n("First Name","first",{type:"text",required:""},(e=>e.value.length<1?(e.warn("We need your first name."),e.empty(),[!1]):[!0,e.key,r(e.value)])),new n("Last Name","last",{type:"text",required:""},(e=>e.value.length<1?(e.warn("We need your last name."),e.empty(),[!1]):[!0,e.key,r(e.value)])),new n("NYCDOE Email","email",{type:"email",required:""},(e=>{if(e.value.length<1)return e.warn("We need your email."),e.empty(),[!1];const t="@nycstudents.net";return!e.value.toLowerCase().endsWith(t)||e.value.length<=t.length?(e.warn("Type in a valid NYCDOE email (ends with @nycstudents.net)."),[!1]):[!0,e.key,e.value.toLowerCase()]})),new n("OSIS","osis",{type:"number",required:"",min:"100000000",max:"999999999"},(e=>{if(e.value.length<1)return e.warn("We need your OSIS."),e.empty(),[!1];const t=parseInt(e.value);return isNaN(t)?(e.warn("Don't think you can get around the system with Inspector Mode."),[!1]):t<1e8||t>999999999?(e.warn("Type in a valid 9-digit OSIS number."),[!1]):[!0,e.key,t]})),new n("Graduation Year","year",{type:"number",required:"",min:""+(new Date).getFullYear(),max:""+((new Date).getFullYear()+5)},(e=>{if(e.value.length<1)return e.warn("We need your graduation year."),e.empty(),[!1];const t=[(new Date).getFullYear(),(new Date).getFullYear()+5],n=parseInt(e.value);return isNaN(n)?(e.warn("Don't think you can get around the system with Inspector Mode."),[!1]):n<t[0]||n>t[1]?(e.warn("Type in a valid high school graduation year."),[!1]):[!0,e.key,n]})),new n("Have SGO Sticker","sgo",{type:"text",required:"",placeholder:"yes | no"},(e=>{if(e.value.length<1)return e.warn("We need to know if you have it or not."),e.empty(),[!1];const t=e.value.toLowerCase();return["yes","no"].includes(t)?[!0,e.key,t]:(e.warn("Type in yes OR no. Please."),[!1])}))],i=t({class:"status"},";;;;",[]);for(const n of[i,...a.map((e=>e.node)),t({},";;;;",function(){function e(e,t){return i.style.display="block",i.style.backgroundColor=e,i.innerHTML=t}const t=document.createElement("span");return t.innerHTML="Submit",t.onclick=t=>{i.style.display="none";const n=a.map((e=>e.check()));if(n.filter((e=>!e[0])).length>0)return e("rgb(255,212,212)","Invalid fields. Please fix them before resubmitting.");const r=new Date,s={date:""+r.get12AMTime(),timestamp:""+r.getTime()};for(const e of n)s[e[1]]=""+e[2];!async function(){const t=firebase.database();await t.ref("meta").once("value").then((e=>(""+e.val().date).trim()!=s.date))?e("rgb(255,212,212)","We are currently not accepting attendance forms. However, if you know for a fact that we are recieving forms right now, you are probably seeing this message because we are currently processing a lot of requests, so please resubmit later."):await t.ref("entries").push(s,(e=>!e))?(e("rgb(212,255,212)","We have successfully recieved your attendance fom. You are good to go."),a.forEach((e=>{e.empty()}))):e("rgb(255,212,212)","You are seeing this message because we are either processing a lot of forms right now or your form failed to send. Please resubmit later.")}()},[t]}())])e.appendChild(n)}();
