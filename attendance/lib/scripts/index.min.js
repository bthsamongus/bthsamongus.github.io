!function(){class e{static senderId=null;static init(){if(e.senderId)return;const t="abcdefghijklmnopqrstuvwxyz1234567890".split(""),n=[];for(let e=0;e<10;e++){let e=t[Math.floor(Math.random()*t.length)];Math.random()<.5&&(e=e.toUpperCase()),n.push(e)}e.senderId=`${n.join("")}-${(new Date).getTime()}`}constructor(e){this.id=null,this.type=(""+e).toUpperCase(),this.content={}}write(e,t){return this.content[e]=t,this}async send(){this.id=await r.ref("/client/"+e.senderId).push().key;const t={senderId:e.senderId,timestamp:firebase.database.ServerValue.TIMESTAMP};Object.assign(t,this);const n=`${t.senderId}/${this.id}`,s=$.extend(!0,{confirm:!1,success:!1},t);let i=!1;await r.ref("/client/"+n).set(t).catch((e=>{i=!0,s.content.message=e.message||"DEFAULT-ERROR-MSG"}));const a="USER-GOT-RESPONSE"==this.type;return a&&(s.success=!0),new Promise(i||a?(e,t)=>{e(s)}:(e,t)=>{const i=r.ref("/server/"+n);let a=!1;i.on("value",(t=>{const n=t.val();n&&(a=!0,Object.assign(s,n),s.confirm=!0,i.off(),e(s))}),(t=>{a=!0,s.content.message=t.message,e(s)})),setTimeout((()=>{a||(i.off(),s.content.message="server took too long to respond",e(s))}),2e3)})}}class t{constructor(e,t,n){this.hasWarned=!0,this.validate=n.bind(this);const i=document.createElement("h2");i.innerHTML=(""+e).trim();const r=document.createElement("input");r.oninput=e=>{this.hasWarned&&this.unwarn()},s.setAttributes(r,t),this.input=r;const a=document.createElement("p");a.innerHTML="sample warning",this.warning=a;const o=document.createElement("section");s.setAttributes(o,{class:"field","data-field-incorrect":"false"}),s.addChildren(o,[i,r,a]),this.node=o,this.unwarn()}get value(){return(""+this.input.value).trim()}unwarn(){this.hasWarned&&(this.hasWarned=!1,this.node.setAttribute("data-field-incorrect","false"),this.node.removeChild(this.warning))}warn(e){this.hasWarned||this.node.appendChild(this.warning),this.hasWarned=!0,this.node.setAttribute("data-field-incorrect","true"),this.warning.innerHTML=(""+e).trim()}check(){return[...this.validate(this)]}empty(){this.input.value=""}}class n{constructor(e,t){const n=document.createElement("section"),s=document.createElement("div"),i=document.createElement("span");s.appendChild(i),n.setAttribute("class","loader"),n.appendChild(s),this.node=n,this._text=null,this.parent=t||null,e&&this.parse(e).length>0&&(this.text=e,n.appendChild(this.text)),t&&this.add()}set text(e){null==this._text&&(this._text=document.createElement("p")),this._text.innerHTML=this.parse(e)}get text(){return this._text}set parent(e){if("string"==typeof e){const t=document.querySelector(this.parse(e));t&&(this._parent=t)}else this._parent=e}parse(e){return(""+e).trim()}add(e){null!=this._parent&&(this.node.remove(),e||this._parent.appendChild(this.node))}stop(){this.add(!0)}}class s{static setAttributes(e,t){for(const n in t)e.setAttribute((""+n).trim(),(""+t[n]).trim())}static addChildren(e,t){for(const n of t)e.appendChild(n)}static formatName(e){const t=[...e.matchAll(/[^\s]+/g)].map((e=>e[0].toLowerCase()));for(let e=0;e<t.length;e++){const n=t[e].split("");for(let e=0;e<n.length;e++)if(/[a-z]/.test(n[e])){n[e]=n[e].toUpperCase();break}t[e]=n.join("")}return t.join(" ")}static get12AMTime(e){let t=(""+(e||new Date).toString()).split(" ");return t[4]="00:00:00",new Date(t.join(" ")).getTime()}}firebase.initializeApp({apiKey:"AIzaSyBQQPdSR_XQ8vW5ud0rKCkZqrNnrcC8jQs",authDomain:"bthsamongus.firebaseapp.com",databaseURL:"https://bthsamongus.firebaseio.com",projectId:"bthsamongus",storageBucket:"bthsamongus.appspot.com",messagingSenderId:"958186855973",appId:"1:958186855973:web:96ea662fa0b3464f0da9cc"});const i=firebase.auth(),r=firebase.database();i.onAuthStateChanged((e=>{e?a.changeAuth(!0):a.changeAuth(!1)}));const a=(new class{constructor(){return this.container=document.querySelector(".header"),this.anchors=[],this.mobileOpened=!0,this.authOpened=!0,this}toggleMobile(){return this.mobileOpened=!this.mobileOpened,this.container.setAttribute("data-mobile-opened",this.mobileOpened),this}changeAuth(e){return this.authOpened=e,this.container.setAttribute("data-auth-opened",""+e),this}addAnchor(e,t){const n=document.createElement("a");n.innerHTML=(""+e).trim(),n.setAttribute("href",t||".");const s=document.createElement("div");return s.appendChild(n),this.anchors.push(s),this}compileAndRun(){function e(){const e=document.createElement("div"),t=document.createElement("span");return t.innerHTML="Sign Out",t.onclick=e=>{i.signOut()},e.appendChild(t),e}const t=document.createElement("div");t.setAttribute("class","important");const n=document.createElement("img");s.setAttributes(n,{alt:"hamburger icon",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png"}),n.onclick=e=>{this.toggleMobile()},t.appendChild(n);const r=document.createElement("section");r.setAttribute("class","nav"),s.addChildren(r,[...this.anchors,e(),t]);const a=document.createElement("section");return a.setAttribute("class","panel"),s.addChildren(a,[...this.anchors.slice(1).map((e=>e.cloneNode(!0))),e()]),this.container.innerHTML="",s.addChildren(this.container,[r,a]),this.toggleMobile(),this.changeAuth(!1),this}}).addAnchor("BTHS Among Us","..").addAnchor("Home","..").addAnchor("Attendance").addAnchor("Executives","../execs").compileAndRun();e.init();document.querySelector(".main .input").appendChild(new class{constructor(e,t){this.title=e,this.fields=[],this.submit=t.bind(this),this.statusShown=!0,this.overlayShown=!0,this.isSubmitting=!1;const n=document.createElement("section");return n.setAttribute("class","form"),this.node=n,this}get fieldResults(){const e=[];for(const t of this.fields)e.push([...t.check()]);return e}addField(e){return this.fields.push(e),this}compile(){const e=document.createElement("section");e.setAttribute("class","content"),this.content;const t=document.createElement("h1");t.innerHTML=(""+this.title).trim();const i=document.createElement("section");i.setAttribute("data-response-type","bad"),i.innerHTML="Sample status",this.status=i;const r=[];for(const e of this.fields)r.push(e.node);const a=document.createElement("section"),o=document.createElement("span");o.innerHTML="Submit";o.onclick=e=>{this.submit(this)},a.appendChild(o),s.addChildren(e,[t,i,...r,a]);const d=document.createElement("section");return d.setAttribute("class","overlay"),this.loader=new n("Loading",d),this.overlay=d,this.node.innerHTML="",s.addChildren(this.node,[e,d]),this.hideStatus(),this.hideOverlay(),this}hideStatus(){return this.statusShown&&(this.statusShown=!1,this.status.style.display="none"),this}updateStatus(e,t){return this.statusShown=!0,this.status.style.display="block",this.status.setAttribute("data-response-type",e?"bad":"good"),this.status.innerHTML=(""+t).trim(),this}hideOverlay(){return this.overlayShown&&(this.overlayShown=!1,this.overlay.style.display="none"),this}updateOverlay(e){return this.overlayShown=!0,this.overlay.style.display="block",this.loader.text=e,this}empty(){for(const e of this.fields)e.empty();return this}}("Form",(async t=>{if(t.isSubmitting)return;t.isSubmitting=!0,t.hideStatus();const n=t.fieldResults,s=[!0,"Your form was filled out incorrectly. Fix it before resubmitting."];do{if(t.updateOverlay("Checking inputs"),n.filter((e=>!e[0])).length>0)break;t.updateOverlay("Pinging server");const i=await new e("PING").send();if(i.confirm&&await new e("USER-GOT-RESPONSE").write("prevResId",i.id).send(),!i.success){s[1]="Server took too long to respond, so form submission was aborted.";break}t.updateOverlay("Sending form");const r="first;last;email;osis;year;sgo".split(";"),a=[...n.map((e=>e[1]))],o=new e("ACCEPT-FORM");for(let e=0;e<r.length;e++)o.write(r[e],a[e]);const d=await o.send();d.confirm&&await new e("USER-GOT-RESPONSE").write("prevResId",d.id).send(),d.success?(s[0]=!1,s[1]="Successfully sent form."):s[1]=d.content.message||"An unknown error came up during submission."}while(0);t.updateStatus(...s),s[0]||t.empty(),t.isSubmitting=!1,t.hideOverlay()})).addField(new t("First Name",{required:"",type:"text"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}n=[!0,s.formatName(t)]}while(0);return n}))).addField(new t("Last Name",{required:"",type:"text"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}n=[!0,s.formatName(t)]}while(0);return n}))).addField(new t("NYCDOE Email",{required:"",type:"email"},(e=>{let t=e.value.toLowerCase(),n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^[^@]+@nycstudents\.net$/.test(t)){e.warn("Enter in a valid @nycstudents.net email");break}n=[!0,t]}while(0);return n}))).addField(new t("OSIS",{required:"",type:"number"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^[1-9]\d{8}$/.test(t)){e.warn("Enter in a valid 9-digit OSIS");break}n=[!0,parseInt(t)]}while(0);return n}))).addField(new t("Graduation Year",{required:"",type:"number"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!new RegExp(`^(${function(){let e=(new Date).getFullYear(),t=[];(new Date).getMonth()>5&&e++;for(let n=0;n<4;n++)t.push(e+n);return t.join("|")}()})$`).test(t)){e.warn("Enter in a valid graduation year");break}n=[!0,parseInt(t)]}while(0);return n}))).addField(new t("Have SGO Sticker",{required:"",type:"text",placeholder:"yes | no"},(e=>{let t=e.value.toLowerCase(),n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^(yes|no)$/.test(t)){e.warn("Enter in yes OR no");break}n=[!0,"yes"===t]}while(0);return n}))).compile().node)}();
