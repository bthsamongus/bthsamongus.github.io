!function(){class e{static setAttributes(e,t){for(const n in t)e.setAttribute((""+n).trim(),(""+t[n]).trim())}static addChildren(e,t){for(const n of t)e.appendChild(n)}static formatName(e){const t=[...e.matchAll(/[^\s]+/g)].map((e=>e[0].toLowerCase()));for(let e=0;e<t.length;e++){const n=t[e].split("");for(let e=0;e<n.length;e++)if(/[a-z]/.test(n[e])){n[e]=n[e].toUpperCase();break}t[e]=n.join("")}return t.join(" ")}static get12AMTime(e){let t=(""+(e||new Date).toString()).split(" ");return t[4]="00:00:00",new Date(t.join(" ")).getTime()}}class t{constructor(e,t){const n=document.createElement("section"),i=document.createElement("div"),s=document.createElement("span");i.appendChild(s),n.setAttribute("class","loader"),n.appendChild(i),this.node=n,this._text=null,this.parent=t||null,e&&this.parse(e).length>0&&(this.text=e,n.appendChild(this.text)),t&&this.add()}set text(e){null==this._text&&(this._text=document.createElement("p")),this._text.innerHTML=this.parse(e)}get text(){return this._text}set parent(e){if("string"==typeof e){const t=document.querySelector(this.parse(e));t&&(this._parent=t)}else this._parent=e}parse(e){return(""+e).trim()}add(e){null!=this._parent&&(this.node.remove(),e||this._parent.appendChild(this.node))}stop(){this.add(!0)}}class n{constructor(t,n,i){this.hasWarned=!0,this.validate=i.bind(this);const s=document.createElement("h2");s.innerHTML=(""+t).trim();const r=document.createElement("input");r.oninput=e=>{this.hasWarned&&this.unwarn()},e.setAttributes(r,n),this.input=r;const a=document.createElement("p");a.innerHTML="sample warning",this.warning=a;const o=document.createElement("section");e.setAttributes(o,{class:"field","data-field-incorrect":"false"}),e.addChildren(o,[s,r,a]),this.node=o,this.unwarn()}get value(){return(""+this.input.value).trim()}unwarn(){this.hasWarned&&(this.hasWarned=!1,this.node.setAttribute("data-field-incorrect","false"),this.node.removeChild(this.warning))}warn(e){this.hasWarned||this.node.appendChild(this.warning),this.hasWarned=!0,this.node.setAttribute("data-field-incorrect","true"),this.warning.innerHTML=(""+e).trim()}check(){return[...this.validate(this)]}empty(){this.input.value=""}}firebase.initializeApp({apiKey:"AIzaSyBQQPdSR_XQ8vW5ud0rKCkZqrNnrcC8jQs",authDomain:"bthsamongus.firebaseapp.com",databaseURL:"https://bthsamongus.firebaseio.com",projectId:"bthsamongus",storageBucket:"bthsamongus.appspot.com",messagingSenderId:"958186855973",appId:"1:958186855973:web:96ea662fa0b3464f0da9cc"});const i=firebase.auth(),s=firebase.database();i.onAuthStateChanged((e=>{e?r.changeAuth(!0):r.changeAuth(!1)}));const r=(new class{constructor(){return this.container=document.querySelector(".header"),this.anchors=[],this.mobileOpened=!0,this.authOpened=!0,this}toggleMobile(){return this.mobileOpened=!this.mobileOpened,this.container.setAttribute("data-mobile-opened",this.mobileOpened),this}changeAuth(e){return this.authOpened=e,this.container.setAttribute("data-auth-opened",""+e),this}addAnchor(e,t){const n=document.createElement("a");n.innerHTML=(""+e).trim(),n.setAttribute("href",t||".");const i=document.createElement("div");return i.appendChild(n),this.anchors.push(i),this}compileAndRun(){function t(){const e=document.createElement("div"),t=document.createElement("span");return t.innerHTML="Sign Out",t.onclick=e=>{i.signOut()},e.appendChild(t),e}const n=document.createElement("div");n.setAttribute("class","important");const s=document.createElement("img");e.setAttributes(s,{alt:"hamburger icon",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png"}),s.onclick=e=>{this.toggleMobile()},n.appendChild(s);const r=document.createElement("section");r.setAttribute("class","nav"),e.addChildren(r,[...this.anchors,t(),n]);const a=document.createElement("section");return a.setAttribute("class","panel"),e.addChildren(a,[...this.anchors.slice(1).map((e=>e.cloneNode(!0))),t()]),this.container.innerHTML="",e.addChildren(this.container,[r,a]),this.toggleMobile(),this.changeAuth(!1),this}}).addAnchor("BTHS Among Us","..").addAnchor("Home","..").addAnchor("Attendance").addAnchor("Executives","../execs").compileAndRun();document.querySelector(".main .input").appendChild(new class{constructor(e,t){this.title=e,this.fields=[],this.submit=t.bind(this),this.statusShown=!0,this.overlayShown=!0,this.isSubmitting=!1;const n=document.createElement("section");return n.setAttribute("class","form"),this.node=n,this}get fieldResults(){const e=[];for(const t of this.fields)e.push([...t.check()]);return e}addField(e){return this.fields.push(e),this}compile(){const n=document.createElement("section");n.setAttribute("class","content"),this.content;const i=document.createElement("h1");i.innerHTML=(""+this.title).trim();const s=document.createElement("section");s.setAttribute("data-response-type","bad"),s.innerHTML="Sample status",this.status=s;const r=[];for(const e of this.fields)r.push(e.node);const a=document.createElement("section"),o=document.createElement("span");o.innerHTML="Submit";o.onclick=e=>{this.submit(this)},a.appendChild(o),e.addChildren(n,[i,s,...r,a]);const d=document.createElement("section");return d.setAttribute("class","overlay"),this.loader=new t("Loading",d),this.overlay=d,this.node.innerHTML="",e.addChildren(this.node,[n,d]),this.hideStatus(),this.hideOverlay(),this}hideStatus(){return this.statusShown&&(this.statusShown=!1,this.status.style.display="none"),this}updateStatus(e,t){return this.statusShown=!0,this.status.style.display="block",this.status.setAttribute("data-response-type",e?"bad":"good"),this.status.innerHTML=(""+t).trim(),this}hideOverlay(){return this.overlayShown&&(this.overlayShown=!1,this.overlay.style.display="none"),this}updateOverlay(e){return this.overlayShown=!0,this.overlay.style.display="block",this.loader.text=e,this}empty(){for(const e of this.fields)e.empty();return this}}("Form",(t=>{t.isSubmitting||(t.isSubmitting=!0,async function(){t.hideStatus();const n=t.fieldResults;let i=[!0,"Your form was filled out incorrectly. Fix it before resubmitting."];do{if(t.updateOverlay("Checking Inputs"),n.filter((e=>!e[0])).length>0)break;t.updateOverlay("Sending Form");const r=[...n.map((e=>e[1]))];r.push(""+(new Date).getTime()),r.push(""+e.get12AMTime());const a="first;last;email;osis;year;sgo;timestamp;date".split(";"),o={};for(let e=0;e<a.length;e++)o[a[e]]=r[e];await s.ref("entries").push(o,(e=>{e?i[1]="We can't recieve your form right now. Please try again later.":i=[!1,"We have successful recieved your form."]})).catch((e=>{e&&(i[1]="Your form was rejected. Most likely reason: our inbox is not open. On rare occassions: we are at peak connection, so you will have to try again later.")}))}while(0);setTimeout((()=>{t.updateStatus(...i),i[0]||t.empty(),t.isSubmitting=!1,t.hideOverlay()}),500)}())})).addField(new n("First Name",{required:"",type:"text"},(t=>{let n=t.value,i=[!1,null];do{if(n.length<1){t.warn("Required");break}i=[!0,e.formatName(n)]}while(0);return i}))).addField(new n("Last Name",{required:"",type:"text"},(t=>{let n=t.value,i=[!1,null];do{if(n.length<1){t.warn("Required");break}i=[!0,e.formatName(n)]}while(0);return i}))).addField(new n("NYCDOE Email",{required:"",type:"email"},(e=>{let t=e.value.toLowerCase(),n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^[^@]+@nycstudents\.net$/.test(t)){e.warn("Enter in a valid @nycstudents.net email");break}n=[!0,t]}while(0);return n}))).addField(new n("OSIS",{required:"",type:"number"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^[1-9]\d{8}$/.test(t)){e.warn("Enter in a valid 9-digit OSIS");break}n=[!0,t]}while(0);return n}))).addField(new n("Graduation Year",{required:"",type:"number"},(e=>{let t=e.value,n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!new RegExp(`^(${function(){let e=(new Date).getFullYear(),t=[];(new Date).getMonth()>5&&e++;for(let n=0;n<4;n++)t.push(e+n);return t.join("|")}()})$`).test(t)){e.warn("Enter in a valid graduation year");break}n=[!0,t]}while(0);return n}))).addField(new n("Have SGO Sticker",{required:"",type:"text",placeholder:"yes | no"},(e=>{let t=e.value.toLowerCase(),n=[!1,null];do{if(t.length<1){e.warn("Required");break}if(!/^(yes|no)$/.test(t)){e.warn("Enter in yes OR no");break}n=[!0,t]}while(0);return n}))).compile().node)}();
